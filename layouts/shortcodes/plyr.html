{{ $video := .Get "src" }}
{{ $poster := .Get "poster" | default "" }}
{{ $ratio := .Get "ratio" | default "16:9" }}
{{ $subtitle := .Get "subtitle" }}

<div class="plyr__video-embed" data-plyr-provider="html5" data-plyr-ratio="{{ $ratio }}">
  <video 
    {{ with $poster }}poster="{{ . }}"{{ end }}
    controls 
    playsinline
    class="plyr__video"
  >
    <source src="{{ $video }}" type="video/mp4" />
    {{ with $subtitle }}
    <track src="{{ . }}" kind="subtitles" srclang="zh" label="中文" default>
    {{ end }}
    您的浏览器不支持 HTML5 视频播放
  </video>
</div>

{{/* 引入 plyr 样式和脚本（如果尚未引入） */}}
{{ if not (.Page.Scratch.Get "plyr_loaded") }}
  {{ .Page.Scratch.Set "plyr_loaded" true }}
  <link rel="stylesheet" href="/js/plyr/dist/plyr.css" />
  <script src="/js/plyr/dist/plyr.polyfilled.js"></script>
  <style>
    /* 自定义样式实现透明字幕背景和位置调整 */
    .plyr__captions {
      background-color: transparent !important;
      bottom: 10px !important;
      padding: 0 !important;
    }
    
    .plyr__caption {
      background-color: transparent !important;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7) !important;
    }
  </style>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const players = Plyr.setup('.plyr__video', {
        captions: { active: true, language: 'zh' }
      });
    });
  </script>
{{ end }}
